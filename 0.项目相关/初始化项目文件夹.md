### 准备工作

1.  确保你已经安装了 **Python 3.11**。
2.  打开你的终端（在 Windows 上是 **Command Prompt** 或 **PowerShell**，在 macOS/Linux 上是 **Terminal**）。

---

### 详细步骤

#### 第 1 步：创建项目根目录并进入

首先，在你喜欢的位置创建一个项目文件夹，并进入该目录。

```bash
# 创建项目文件夹
mkdir mdms_project

# 进入该文件夹
cd mdms_project
```

#### 第 2 步：创建并激活 Python 虚拟环境

这是一个至关重要的步骤，它能确保你的项目依赖与系统全局的 Python 环境隔离。

```bash
# 创建名为 .venv 的虚拟环境
python -m venv .venv

# 激活虚拟环境
# 在 Windows 上:
# .venv\Scripts\activate
#
# 在 macOS 或 Linux 上:
# source .venv/bin/activate
```

激活成功后，你的命令行提示符前面应该会有一个 `(.venv)` 的标识。

#### 第 3 步：创建 `requirements.txt` 并安装依赖

现在，我们来定义项目需要的所有库。

1.  **创建 `requirements.txt` 文件**：

    在 `mdms_project` 目录下创建一个名为 `requirements.txt` 的文件，并填入以下内容：

    ```txt
    # requirements.txt
    PySide6
    SQLAlchemy
    PyMySQL
    alembic
    configparser
    ```
    *(我们添加了 `configparser` 用于读取 `.ini` 文件)*

2.  **使用 pip 安装所有依赖**：

    运行以下命令，它会自动读取 `requirements.txt` 文件并安装所有列出的库。

    ```bash
    pip install -r requirements.txt
    ```

#### 第 4 步：创建完整的目录和文件结构

现在，我们来批量创建所有需要的文件夹和空的 Python 文件。

**对于 macOS / Linux 用户 (推荐):**

你可以直接复制并粘贴以下整段命令，它会一次性创建所有目录和空的 `__init__.py` 文件。

```bash
mkdir -p mdms/assets/icons mdms/assets/images mdms/controllers mdms/database mdms/views/ui
touch mdms/__init__.py mdms/controllers/__init__.py mdms/database/__init__.py mdms/views/__init__.py
touch config.ini main.py
touch mdms/database/models.py mdms/database/session.py
touch mdms/controllers/main_controller.py
touch mdms/views/main_window.py
touch mdms/views/ui/main_window.ui
```

**对于 Windows 用户:**

Windows 的 `cmd` 不支持 `mkdir -p` 和 `touch`。你可以逐条执行 `mkdir`，或者直接在文件资源管理器中手动创建。

```cmd
mkdir mdms
mkdir mdms\assets
mkdir mdms\assets\icons
mkdir mdms\assets\images
mkdir mdms\controllers
mkdir mdms\database
mkdir mdms\views
mkdir mdms\views\ui

:: 创建空的 __init__.py 文件
type nul > mdms\__init__.py
type nul > mdms\controllers\__init__.py
type nul > mdms\database\__init__.py
type nul > mdms\views\__init__.py

:: 创建其他文件
type nul > config.ini
type nul > main.py
type nul > mdms\database\models.py
type nul > mdms\database\session.py
type nul > mdms\controllers\main_controller.py
type nul > mdms\views\main_window.py
type nul > mdms\views\ui\main_window.ui
```

---

#### 第 5 步：填充核心文件的初始代码

这是最关键的一步。你需要用代码编辑器（如 VS Code）打开 `mdms_project` 文件夹，然后将以下代码片段复制到对应文件中。

**1. `config.ini`**

```ini
[database]
type = mysql+pymysql
username = root
password = your_secret_password
host = localhost
port = 3306
db_name = mdms_db
```
> **注意：** 请将 `your_secret_password` 替换为你的真实数据库密码。

**2. `mdms/database/session.py`**

```python
# mdms/database/session.py
import configparser
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# 读取配置文件
config = configparser.ConfigParser()
# 注意路径是相对于项目根目录的
config.read('config.ini') 
db_config = config['database']

# 构建数据库连接 URL
DATABASE_URL = (
    f"{db_config['type']}://"
    f"{db_config['username']}:{db_config['password']}@"
    f"{db_config['host']}:{db_config['port']}/"
    f"{db_config['db_name']}?charset=utf8mb4"
)

# 创建数据库引擎
engine = create_engine(DATABASE_URL, echo=True) # echo=True 会打印执行的 SQL 语句，方便调试

# 创建会话工厂
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# 提供一个简单的函数来获取数据库会话
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

**3. `mdms/database/models.py`**

```python
# mdms/database/models.py
from sqlalchemy.orm import declarative_base, relationship
from sqlalchemy import Column, String, Integer, Date, ForeignKey, Text
import uuid

# 所有数据模型的基类
Base = declarative_base()

# 示例：电影表
class Movie(Base):
    __tablename__ = 'movies'
    
    # 使用 UUID 作为主键，更适合分布式系统
    movie_id = Column(String(36), primary_key=True, default=lambda: str(uuid.uuid4()))
    title = Column(String(255), nullable=False, index=True)
    release_date = Column(Date)
    country = Column(String(100))
    
    # 在这里定义其他字段...
    
    def __repr__(self):
        return f"<Movie(title='{self.title}')>"

# 在这里继续定义 Users, People, Reviews 等所有其他模型...
# 例如：
# class User(Base):
#     __tablename__ = 'users'
#     ...
```

**4. `mdms/views/ui/main_window.ui`**

这是一个 XML 文件，你可以用 Qt Designer 打开并可视化地编辑它。现在，我们先放一个最简单的窗口进去。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ui version="4.0">
 <class>MainWindow</class>
 <widget class="QMainWindow" name="MainWindow">
  <property name="geometry">
   <rect>
    <x>0</x>
    <y>0</y>
    <width>800</width>
    <height>600</height>
   </rect>
  </property>
  <property name="windowTitle">
   <string>电影数据管理系统 (MDMS)</string>
  </property>
  <widget class="QWidget" name="centralwidget">
   <layout class="QVBoxLayout" name="verticalLayout">
    <item>
     <widget class="QLabel" name="label">
      <property name="text">
       <string>欢迎使用 MDMS!</string>
      </property>
      <property name="alignment">
       <set>Qt::AlignCenter</set>
      </property>
     </widget>
    </item>
    <item>
     <widget class="QPushButton" name="button_search">
      <property name="text">
       <string>这是一个搜索按钮</string>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
  <widget class="QMenuBar" name="menubar"/>
  <widget class="QStatusBar" name="statusbar"/>
 </widget>
 <resources/>
 <connections/>
</ui>
```

**5. `mdms/views/main_window.py`**

```python
# mdms/views/main_window.py
import os
from PySide6.QtWidgets import QMainWindow
from PySide6.QtUiTools import QUiLoader
from PySide6.QtCore import QFile

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        # 使用 QUiLoader 加载 .ui 文件
        # 这种方式更灵活，推荐
        ui_file_path = os.path.join(os.path.dirname(__file__), "ui/main_window.ui")
        ui_file = QFile(ui_file_path)
        ui_file.open(QFile.ReadOnly)
        
        loader = QUiLoader()
        self.ui = loader.load(ui_file, self)
        
        ui_file.close()

        # 现在可以通过 self.ui.控件名 来访问 .ui 文件中定义的控件
        # 例如: self.ui.button_search, self.ui.label
```

**6. `mdms/controllers/main_controller.py`**

```python
# mdms/controllers/main_controller.py
from mdms.views.main_window import MainWindow
from mdms.database.session import SessionLocal
from mdms.database.models import Movie # 引入你的模型

class MainController:
    def __init__(self):
        self.view = MainWindow()
        self.db_session = SessionLocal()

        # 将视图(View)中的信号连接到控制器(Controller)的槽函数
        self.connect_signals()

    def connect_signals(self):
        """连接所有UI控件的信号到对应的处理函数"""
        self.view.ui.button_search.clicked.connect(self.search_movies)

    def search_movies(self):
        """处理搜索按钮点击事件的逻辑"""
        # 1. 从 View 获取输入 (未来添加)
        # search_text = self.view.ui.line_edit_search.text()
        print("搜索按钮被点击了！")
        
        # 2. 与 Model 交互，查询数据库
        # 示例：查询所有电影
        all_movies = self.db_session.query(Movie).all()
        print(f"从数据库中查询到 {len(all_movies)} 部电影。")
        for movie in all_movies:
            print(f" - {movie.title}")
            
        # 3. 更新 View (未来添加)
        # self.view.update_movie_list(all_movies)
        
    def show(self):
        """显示主窗口"""
        self.view.show()

    def __del__(self):
        """在对象销毁时确保数据库会话被关闭"""
        if self.db_session:
            self.db_session.close()
```

**7. `main.py` (项目入口)**

```python
# main.py
import sys
from PySide6.QtWidgets import QApplication
from mdms.controllers.main_controller import MainController
from mdms.database.models import Base
from mdms.database.session import engine

def main():
    # 初始化数据库 (如果表不存在，则创建)
    # 在生产环境中，你会使用 Alembic 来管理数据库迁移
    print("正在初始化数据库，创建表结构...")
    Base.metadata.create_all(bind=engine)
    print("数据库初始化完成。")

    # 创建 Qt 应用实例
    app = QApplication(sys.argv)
    
    # 创建主控制器
    controller = MainController()
    
    # 显示主窗口
    controller.show()
    
    # 启动应用事件循环
    sys.exit(app.exec())

if __name__ == "__main__":
    main()
```

#### 第 6 步：(推荐) 初始化 Alembic

在项目根目录 (`mdms_project/`) 运行：

```bash
alembic init alembic
```

这个命令会自动创建 `alembic` 文件夹和 `alembic.ini` 文件。你还需要做一步关键配置：

1.  打开 `alembic/env.py` 文件。
2.  找到 `target_metadata = None` 这一行。
3.  将其修改为导入并指向你 `models.py` 中的 `Base.metadata`，如下：

    ```python
    # alembic/env.py
    
    # ... 其他 import ...
    # 添加下面两行
    from mdms.database.models import Base
    target_metadata = Base.metadata
    
    # ... 文件其余部分 ...
    ```

4.  打开 `alembic.ini` 文件，找到 `sqlalchemy.url` 这一行，将其修改为你的数据库连接信息（可以直接从 `config.ini` 复制）。

    ```ini
    # alembic.ini
    sqlalchemy.url = mysql+pymysql://root:your_secret_password@localhost:3306/mdms_db
    ```

---

### 完成！

现在，你的项目骨架就完全搭建好了！

你可以通过在终端（确保虚拟环境已激活）中运行 `main.py` 来启动你的应用程序：

```bash
python main.py
```

你会看到一个简单的窗口弹出，并且终端会打印出数据库连接和查询的信息。

**接下来做什么？**

1.  用 **Qt Designer** 打开 `mdms/views/ui/main_window.ui`，开始设计你的主界面。
2.  在 `mdms/database/models.py` 中，根据你的数据库设计，完成所有表的模型定义。
3.  在 `mdms/controllers/main_controller.py` 中，为你界面上的每一个交互功能（如增、删、改、查）编写对应的业务逻辑函数。