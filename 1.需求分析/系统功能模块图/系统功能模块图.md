

## 电影资料库管理系统 (MDMS) - 功能模块详解

系统在逻辑上分为四大功能模块。以下是每个模块的详细设计，包括其**核心功能**、**涉及实体**和**关系逻辑**。

### 1. 🎬 用户与权限管理模块 (User & Permission Management)



- 模块功能描述:

  

- **核心功能:**

  - **用户注册:** 提供新用户账户创建功能（`username`, `email`, `password`）。
  - **用户登录:** 验证用户凭据，登录成功后生成并返回身份令牌（如 JWT）。
  - **[管理员] 用户管理:** 允许管理员查看、删除或修改其他用户的角色。

- **涉及的实体 (Tables):**

  - **Users (用户表):** 模块的核心实体。

  



### 2. 🍿 电影核心资料库模块 (Core Movie Database)



- 模块描述:

  

- **核心功能:**

  - **[管理员] 电影管理:**
    - `(C)` 添加新电影：录入电影的标题、简介、上映日期、海报等信息。
    - `(U)` 修改电影信息：更新已存在电影的资料。
    - `(D)` 删除电影：从数据库中移除电影及其所有关联（如影评、类型、演职员关系）。
  - **[管理员] 参与人管理:**
    - `(C)` 添加参与人：录入演员/导演的姓名、简介、照片等。
    - `(U)` 修改参与人信息。
    - `(D)` 删除参与人。
  - **[管理员] 类型管理:**
    - `(C)` 添加新类型（如：悬疑、太空歌剧）。
    - `(U)` / `(D)` 编辑或删除类型。
  - **[管理员] 关系维护:**
    - `Movie_Genres`: 关联一部电影到一个或多个类型。
    - `Movie_Crew`: 关联一部电影到一个或多个参与人，并指定其职责 (`role` 如 'Actor') 和角色名 (`character_name`)。

- **涉及的实体 (Tables):**

  - **Movies (电影表)**
  - **People (参与人表)**
  - **Genres (类型表)**
  - **Movie_Genres (电影-类型 连接表)**
  - **Movie_Crew (电影-参与人 连接表)**

- **模块内的关系与逻辑:**

  - **[M:N] Movies <-> Genres:** 通过 `Movie_Genres` 连接。
  - **[M:N] Movies <-> People:** 通过 `Movie_Crew` 连接。



### 3. ✍️ 影评与评分系统模块 (Review & Rating System)



- 模块描述:

  此模块处理系统中由普通用户驱动的核心交互——发布和管理影评。它还包含关键的后端业务逻辑，用于自动更新电影的统计数据，确保数据一致性。

- **核心功能:**

  - **[用户] 提交影评:** 允许登录用户为某部电影提交评分（1-10）和评论内容。
    - *业务逻辑:* 系统必须检查 `uq_user_movie_review` 约束，确保用户对同一电影只能提交一次评论（“一人一票”）。
  - **[用户] 修改影评:** 允许用户修改自己先前发布的影评或评分。
  - **[用户] 删除影评:** 允许用户删除自己的影评。
  - **[管理员] 管理影评:** 允许管理员删除任何（如违规的）影评。
  - **[系统] 更新统计:** (核心业务逻辑)
    - 当 `Reviews` 表发生 `INSERT`, `UPDATE`, 或 `DELETE` 时，系统必须**自动触发**一个更新。
    - 此更新会重新计算该 `movie_id` 的 `average_rating`（平均分）和 `rating_count`（评分人数）。
    - 并将计算结果写回 `Movies` 表对应的行，实现数据同步。

- **涉及的实体 (Tables):**

  - **Reviews (影评表):** 模块的核心实体。
  - **Users (用户表):** [外部依赖] 提供外键 `user_id`。
  - **Movies (电影表):** [外部依赖] 提供外键 `movie_id`，并作为被更新的对象。

- **模块内的关系与逻辑:**

  - **[1:N] Users -> Reviews**
  - **[1:N] Movies -> Reviews**



### 4. 🔎 数据检索与展示模块 (Data Retrieval & Display)



- 模块描述:

  此模块是系统的“读取”层和数据出口，负责响应前端应用的所有数据查询请求。它不修改任何数据，而是通过高效的数据库查询（主要是 JOIN）将来自不同模块的数据整合在一起，提供给用户查看。

- **核心功能 (API Endpoints):**

  - **搜索功能:**
    - `GET /api/search/movies?q=...`: 按电影标题、简介等关键词搜索电影。
    - `GET /api/search/people?q=...`: 按姓名搜索参与人。
  - **浏览与列表:**
    - `GET /api/movies/latest`: 获取最新上映的电影列表。
    - `GET /api/movies/toprated`: 获取评分最高的电影列表。
    - `GET /api/genres`: 获取所有电影类型列表。
    - `GET /api/genres/{id}/movies`: 获取特定类型下的所有电影。
  - **详情页面:**
    - `GET /api/movies/{id}`: **(核心查询)** 获取单个电影的完整详情，包括：
      - `Movies` 表的基本信息。
      - 关联的 `Genres` 列表。
      - 关联的 `People` 列表（通过 `Movie_Crew`，包含职责和角色名）。
      - 关联的 `Reviews` 列表（包含评论内容和 `Users` 的用户名）。
    - `GET /api/people/{id}`: 获取单个参与人的详情，包括：
      - `People` 表的基本信息。
      - 该参与人的作品列表（通过 `Movie_Crew` 关联到的 `Movies`）。
  - **用户相关:**
    - `GET /api/users/{id}/reviews`: 获取特定用户发布的所有影评。

- **涉及的实体 (Tables):**

  - 此模块**读取 (Read)** 所有实体以组合数据。

- **模块内的关系与逻辑:**

  - 此模块的逻辑主要体现在 `SELECT` 语句中的 `JOIN` 操作，用于将分离的实体数据“缝合”成前端需要的完整视图。